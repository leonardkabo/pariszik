<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParisZik - D√©couvrez la musique du monde entier</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <!-- Configuration et Initialisation -->
    <script src="js/config.js"></script>
    <script src="js/init.js"></script>
    <script src="js/firebase.js"></script>
    <script src="js/content.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="logo">Paris<span>Zik</span></div>
            
            <!-- Menu hamburger pour mobile -->
            <button class="hamburger" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <nav id="mainNav">
                <ul>
                    <li><a href="index.html" class="active">Accueil</a></li>
                    <li><a href="library.html">Biblioth√®que</a></li>
                    <li><a href="live.html">En Direct</a></li>
                    <li><a href="#">Clips</a></li>
                    <li><a href="#">Artistes</a></li>
                </ul>
            </nav>
            
            <div class="auth-buttons" id="authButtons">
                <a href="login.html" class="btn btn-secondary" id="loginBtn">Se connecter</a>
                <a href="signup.html" class="btn btn-primary" id="signupBtn">S'inscrire</a>
                <a href="admin.html" class="btn btn-admin" id="adminBtn" style="display: none;">Admin</a>
                <div class="user-menu" id="userMenu" style="display: none;">
                    <span id="userName">Utilisateur</span>
                    <button class="btn btn-secondary" id="logoutBtn">D√©connexion</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar pour desktop -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>ParisZik</h3>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li><a href="index.html" class="active">Accueil</a></li>
                <li><a href="library.html">Biblioth√®que</a></li>
                <li><a href="favorites.html">Favoris</a></li>
                <li><a href="recent.html">Derniers ajouts</a></li>
                <li><a href="playlists.html">Playlists</a></li>
                <li><a href="artists.html">Artistes</a></li>
                <li><a href="categories.html">Cat√©gories</a></li>
                <li><a href="live.html">En Direct</a></li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar" id="sidebarUserAvatar">üë§</div>
                <div class="user-details">
                    <div class="user-name" id="sidebarUserName">Utilisateur</div>
                    <div class="user-role" id="sidebarUserRole">Membre</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay pour mobile -->
    <div class="overlay" id="overlay"></div>

    <main>
        <section class="hero">
            <div class="container">
                <h1>ParisZik</h1>
                <p>La plateforme de streaming musical qui vous connecte aux artistes du monde entier et aux √©v√©nements en direct</p>
                <div class="search-bar">
                    <input type="text" placeholder="Rechercher un artiste, un titre, un album...">
                    <button>Rechercher</button>
                </div>
            </div>
        </section>

        <div class="tabs">
            <div class="container">
                <div class="tab active" data-tab="popular">Populaire</div>
                <div class="tab" data-tab="new">Nouveaut√©s</div>
                <div class="tab" data-tab="live">En Direct</div>
                <div class="tab" data-tab="playlists">Playlists</div>
            </div>
        </div>

        <section class="content-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Derniers clips ajout√©s</h2>
                    <a href="library.html" class="view-more-btn">Voir plus ‚Üí</a>
                </div>
                <div class="content-grid" id="recentContent">
                    <!-- Les 3 derniers clips seront affich√©s ici -->
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p>Chargement des derniers clips...</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="content-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">En ce moment</h2>
                    <a href="trending.html" class="view-more-btn">Voir plus ‚Üí</a>
                </div>
                <div class="content-grid" id="popularContent">
                    <!-- Contenu populaire -->
                </div>
            </div>
        </section>

        <section class="content-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">√âv√©nements en direct</h2>
                    <a href="live.html" class="view-more-btn">Voir plus ‚Üí</a>
                </div>
                <div class="content-grid" id="liveContent">
                    <!-- √âv√©nements en direct -->
                </div>
            </div>
        </section>

        <div class="player">
            <div class="container">
                <div class="player-container">
                    <img src="assets/images/placeholder.jpg" alt="Now Playing" class="player-img">
                    <div class="player-info">
                        <h4 class="player-title">Aucun titre en lecture</h4>
                        <p class="player-artist">-</p>
                    </div>
                    <div class="player-controls">
                        <button class="control-btn">‚èÆ</button>
                        <button class="control-btn">‚èØ</button>
                        <button class="control-btn">‚è≠</button>
                    </div>
                    <div class="progress">
                        <div class="progress-bar"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>ParisZik</h3>
                    <p>La plateforme de streaming musical qui vous connecte aux artistes du monde entier et aux √©v√©nements en direct.</p>
                    <div class="admin-access">
                        <a href="admin-access.html" class="admin-link">acc√®s admin</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Liens Rapides</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Accueil</a></li>
                        <li><a href="library.html">Biblioth√®que</a></li>
                        <li><a href="live.html">En Direct</a></li>
                        <li><a href="categories.html">Cat√©gories</a></li>
                        <li><a href="artists.html">Artistes</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>L√©gal</h3>
                    <ul class="footer-links">
                        <li><a href="#">Mentions L√©gales</a></li>
                        <li><a href="#">Politique de Confidentialit√©</a></li>
                        <li><a href="#">Conditions d'Utilisation</a></li>
                        <li><a href="#">Cookies</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <ul class="footer-links">
                        <li><a href="#">Support</a></li>
                        <li><a href="#">Nous √©crire</a></li>
                        <li><a href="#">Carri√®res</a></li>
                        <li><a href="#">Partenariats</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2023 ParisZik. Tous droits r√©serv√©s.
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Page d\'accueil charg√©e');
            
            // √âl√©ments du DOM
            const loginBtn = document.getElementById('loginBtn');
            const signupBtn = document.getElementById('signupBtn');
            const adminBtn = document.getElementById('adminBtn');
            const userMenu = document.getElementById('userMenu');
            const userName = document.getElementById('userName');
            const logoutBtn = document.getElementById('logoutBtn');
            const sidebar = document.getElementById('sidebar');
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const overlay = document.getElementById('overlay');
            const sidebarUserName = document.getElementById('sidebarUserName');
            const sidebarUserRole = document.getElementById('sidebarUserRole');
            const sidebarUserAvatar = document.getElementById('sidebarUserAvatar');
            const authButtons = document.getElementById('authButtons');
            
            // Attendre l'initialisation de ParisZik
            try {
                await window.ParisZikInit.initializeFirebase();
                console.log('ParisZik initialis√©:', window.ParisZikInit.getStatus());
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de ParisZik:', error);
            }
            
            // V√©rifier l'√©tat d'authentification
            if (window.ParisZikAuth) {
                window.ParisZikAuth.checkAuthState(function(user) {
                    updateUIBasedOnAuth(user);
                });
            } else {
                console.error('ParisZikAuth non disponible');
                showAuthButtons();
            }
            
            // Fonction pour mettre √† jour l'interface selon l'√©tat d'authentification
            function updateUIBasedOnAuth(user) {
                if (user) {
                    console.log('Utilisateur connect√©:', user.email);
                    
                    // R√©cup√©rer les informations depuis localStorage
                    const storedName = localStorage.getItem('userName');
                    const storedRole = localStorage.getItem('userRole');
                    
                    // Si les informations ne sont pas dans localStorage, les r√©cup√©rer depuis l'utilisateur
                    const displayName = storedName || user.displayName || user.email.split('@')[0];
                    const userRole = storedRole || (window.ParisZikInit?.isAdminUser(user) ? 'admin' : 'user');
                    
                    // Mettre √† jour l'interface
                    userName.textContent = displayName;
                    sidebarUserName.textContent = displayName;
                    sidebarUserRole.textContent = userRole === 'admin' ? 'Administrateur' : 'Membre';
                    sidebarUserAvatar.textContent = displayName.substring(0, 1).toUpperCase();
                    
                    // Afficher le menu utilisateur
                    loginBtn.style.display = 'none';
                    signupBtn.style.display = 'none';
                    userMenu.style.display = 'flex';
                    userMenu.style.alignItems = 'center';
                    userMenu.style.gap = '10px';
                    
                    // Afficher le bouton admin si l'utilisateur est admin
                    if (userRole === 'admin') {
                        adminBtn.style.display = 'inline-block';
                    } else {
                        adminBtn.style.display = 'none';
                    }
                    
                    console.log('Interface utilisateur mise √† jour pour:', displayName);
                } else {
                    console.log('Aucun utilisateur connect√©');
                    showAuthButtons();
                }
            }
            
            // Fonction pour afficher les boutons de connexion/inscription
            function showAuthButtons() {
                loginBtn.style.display = 'inline-block';
                signupBtn.style.display = 'inline-block';
                adminBtn.style.display = 'none';
                userMenu.style.display = 'none';
                sidebarUserName.textContent = 'Invit√©';
                sidebarUserRole.textContent = 'Visiteur';
                sidebarUserAvatar.textContent = 'üë§';
            }
            
            // Gestion de la d√©connexion
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async function() {
                    try {
                        if (window.ParisZikAuth) {
                            await window.ParisZikAuth.signOut();
                            console.log('D√©connexion r√©ussie');
                        }
                        // Recharger la page pour mettre √† jour l'interface
                        window.location.reload();
                    } catch (error) {
                        console.error('Erreur lors de la d√©connexion:', error);
                        alert('Erreur lors de la d√©connexion: ' + error.message);
                    }
                });
            }
            
            // Gestion du menu hamburger
            if (hamburgerBtn && overlay) {
                hamburgerBtn.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                    overlay.classList.toggle('active');
                    hamburgerBtn.classList.toggle('active');
                    document.body.classList.toggle('no-scroll');
                });
                
                overlay.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                    hamburgerBtn.classList.remove('active');
                    document.body.classList.remove('no-scroll');
                });
            }
            
            // Chargement du contenu (simul√© pour cet exemple)
            loadContent();
        });
        
        // Fonction pour charger le contenu (√† adapter selon vos besoins)
        function loadContent() {
            // Simuler le chargement du contenu
            setTimeout(function() {
                document.querySelectorAll('.loading-spinner').forEach(spinner => {
                    spinner.innerHTML = '<p class="no-content">Contenu charg√© !</p>';
                });
            }, 1500);
        }
    </script>
</body>
</html>
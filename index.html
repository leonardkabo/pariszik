<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParisZik - D√©couvrez la musique du monde entier</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <!-- Configuration -->
    <script src="js/config.js"></script>
    <script src="js/init.js"></script>
    <script src="js/admin-auth.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <!-- Favicon et ic√¥nes -->
    <link rel="icon" type="image/webp" href="assets/images/favicon.webp">
    <link rel="apple-touch-icon" sizes="192x192" href="assets/images/icon-192.webp">
    <link rel="apple-touch-icon" sizes="512x512" href="assets/images/icon-512.webp">
</head>
<body>
    <!-- Votre code HTML existant -->

    <!-- Audio Player -->
    <div class="audio-player" id="audioPlayer">
        <div class="player-container">
            <div class="player-cover">
                <img src="assets/images/default-cover.webp" alt="Now Playing" class="player-img">
            </div>
            <div class="player-info">
                <h4 class="player-title">Aucun titre en lecture</h4>
                <p class="player-artist">-</p>
                <div class="player-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-time">
                        <span id="currentTime">0:00</span>
                        <span id="totalTime">0:00</span>
                    </div>
                </div>
            </div>
            <div class="player-controls">
                <button class="control-btn" id="prevBtn">‚èÆ</button>
                <button class="control-btn" id="playBtn">‚ñ∂</button>
                <button class="control-btn" id="nextBtn">‚è≠</button>
                <div class="volume-control">
                    <button class="volume-btn" id="volumeBtn">üîä</button>
                    <div class="volume-slider-container">
                        <div class="volume-slider">
                            <div class="volume-bar" id="volumeBar"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="player-actions">
                <button class="favorite-btn" id="playerFavoriteBtn">‚ù§Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- Votre code HTML existant -->

    <script>
        // Variables globales
        let currentAudio = null;
        let isPlaying = false;
        let currentContent = null;
        
        // Initialiser la page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page d\'accueil charg√©e');
            
            // Initialiser les gestionnaires d'√©v√©nements
            initializeEventListeners();
            
            // Charger les contenus
            loadContent();
        });
        
        // Initialiser les gestionnaires d'√©v√©nements
        function initializeEventListeners() {
            // Gestion du bouton play/pause
            document.getElementById('playBtn').addEventListener('click', togglePlayPause);
            
            // Gestion de la barre de progression
            document.querySelector('.progress-bar-container').addEventListener('click', seek);
            
            // Gestion du volume
            document.getElementById('volumeBtn').addEventListener('click', toggleMute);
            document.querySelector('.volume-slider-container').addEventListener('click', setVolume);
            
            // Gestion des favoris
            document.getElementById('playerFavoriteBtn').addEventListener('click', toggleFavorite);
        }
        
        // Charger le contenu
        function loadContent() {
            try {
                // Charger les contenus depuis localStorage
                const contents = JSON.parse(localStorage.getItem('pariszik_contents') || '[]');
                
                // Trier par date (les plus r√©cents en premier)
                contents.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
                
                // Afficher les 3 derniers clips
                const recentContent = document.getElementById('recentContent');
                recentContent.innerHTML = '';
                
                if (contents.length === 0) {
                    recentContent.innerHTML = '<p class="no-content">Aucun contenu disponible pour le moment.</p>';
                } else {
                    // Prendre les 3 derniers clips
                    const recentClips = contents.slice(0, 3);
                    recentClips.forEach(content => {
                        addContentCard(content, recentContent);
                    });
                }
                
                // Afficher les contenus populaires (par nombre de vues)
                const popularContent = document.getElementById('popularContent');
                popularContent.innerHTML = '';
                
                if (contents.length === 0) {
                    popularContent.innerHTML = '<p class="no-content">Aucun contenu disponible pour le moment.</p>';
                } else {
                    // Trier par nombre de vues
                    const popularClips = [...contents].sort((a, b) => (b.views || 0) - (a.views || 0)).slice(0, 6);
                    popularClips.forEach(content => {
                        addContentCard(content, popularContent);
                    });
                }
                
                // Afficher les contenus en direct
                const liveContent = document.getElementById('liveContent');
                liveContent.innerHTML = '';
                
                if (contents.length === 0) {
                    liveContent.innerHTML = '<p class="no-content">Aucun √©v√©nement en direct pour le moment.</p>';
                } else {
                    // Filtrer les contenus en direct
                    const liveClips = contents.filter(content => content.isLive).slice(0, 3);
                    if (liveClips.length === 0) {
                        liveContent.innerHTML = '<p class="no-content">Aucun √©v√©nement en direct pour le moment.</p>';
                    } else {
                        liveClips.forEach(content => {
                            addContentCard(content, liveContent);
                        });
                    }
                }
            } catch (error) {
                console.error('Erreur lors du chargement des contenus:', error);
                document.getElementById('recentContent').innerHTML = '<p class="error">Erreur lors du chargement des contenus.</p>';
                document.getElementById('popularContent').innerHTML = '<p class="error">Erreur lors du chargement des contenus.</p>';
                document.getElementById('liveContent').innerHTML = '<p class="error">Erreur lors du chargement des contenus.</p>';
            }
        }
        
        // Ajouter une carte de contenu
        function addContentCard(content, container) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.id = content.id;
            
            // D√©terminer l'ic√¥ne selon le type de contenu
            let icon = 'üéµ';
            if (content.contentType === 'video') icon = 'üé¨';
            if (content.contentType === 'live') icon = 'üî¥';
            
            // URL de la miniature (utiliser default-cover.webp si aucune miniature n'est fournie)
            const thumbnailUrl = content.thumbnailUrl || 'assets/images/default-cover.webp';
            
            card.innerHTML = `
                <div class="card-img-container">
                    <img src="${thumbnailUrl}" alt="${content.title}" class="card-img">
                    ${content.isLive ? '<div class="live-overlay"><div class="live-badge">LIVE</div></div>' : ''}
                </div>
                <div class="card-content">
                    <h3 class="card-title">${icon} ${content.title}</h3>
                    <p class="card-artist">üë§ ${content.artist}</p>
                    <div class="card-actions">
                        <button class="play-btn" data-id="${content.id}" data-title="${content.title}" data-artist="${content.artist}" data-file-url="${content.fileUrl}" data-thumbnail-url="${thumbnailUrl}" title="Lire ce contenu">‚ñ∂</button>
                        <button class="favorite-btn" data-id="${content.id}" title="Ajouter aux favoris">‚ù§Ô∏è</button>
                        ${content.isLive ? '<div class="live-badge-small">LIVE</div>' : ''}
                    </div>
                </div>
            `;
            container.appendChild(card);
            
            // Ajouter les gestionnaires d'√©v√©nements
            card.querySelector('.play-btn').addEventListener('click', function() {
                const contentToPlay = {
                    id: this.getAttribute('data-id'),
                    title: this.getAttribute('data-title'),
                    artist: this.getAttribute('data-artist'),
                    fileUrl: this.getAttribute('data-file-url'),
                    thumbnailUrl: this.getAttribute('data-thumbnail-url')
                };
                playContent(contentToPlay);
            });
            
            card.querySelector('.favorite-btn').addEventListener('click', function() {
                toggleFavoriteContent(content.id, this);
            });
        }
        
        // Jouer un contenu
        function playContent(content) {
            // Arr√™ter la lecture en cours si n√©cessaire
            if (currentAudio) {
                currentAudio.pause();
            }
            
            // Cr√©er un nouvel √©l√©ment audio
            currentAudio = new Audio();
            currentAudio.src = content.fileUrl;
            currentContent = content;
            
            // Mettre √† jour l'interface du lecteur
            updatePlayerUI(content);
            
            // G√©rer les √©v√©nements audio
            currentAudio.onloadedmetadata = function() {
                document.getElementById('totalTime').textContent = formatTime(currentAudio.duration);
            };
            
            currentAudio.ontimeupdate = function() {
                document.getElementById('progressBar').style.width = (currentAudio.currentTime / currentAudio.duration * 100) + '%';
                document.getElementById('currentTime').textContent = formatTime(currentAudio.currentTime);
            };
            
            currentAudio.onplay = function() {
                isPlaying = true;
                document.getElementById('playBtn').textContent = '‚è∏';
            };
            
            currentAudio.onpause = function() {
                isPlaying = false;
                document.getElementById('playBtn').textContent = '‚ñ∂';
            };
            
            currentAudio.onended = function() {
                isPlaying = false;
                document.getElementById('playBtn').textContent = '‚ñ∂';
            };
            
            currentAudio.onerror = function() {
                console.error('Erreur de lecture:', currentAudio.error);
                alert('Erreur lors de la lecture du fichier. Veuillez r√©essayer.');
            };
            
            // Jouer le fichier
            currentAudio.play().catch(error => {
                console.error('Erreur de lecture:', error);
                alert('Erreur lors de la lecture: ' + error.message);
            });
            
            // Incr√©menter le nombre de vues
            incrementViews(content.id);
        }
        
        // Mettre √† jour l'interface du lecteur
        function updatePlayerUI(content) {
            document.querySelector('.player-title').textContent = content.title;
            document.querySelector('.player-artist').textContent = content.artist;
            document.querySelector('.player-img').src = content.thumbnailUrl || 'assets/images/default-cover.webp';
        }
        
        // Basculer lecture/pause
        function togglePlayPause() {
            if (!currentAudio) return;
            
            if (isPlaying) {
                currentAudio.pause();
            } else {
                currentAudio.play().catch(error => {
                    console.error('Erreur de lecture:', error);
                    alert('Erreur lors de la lecture: ' + error.message);
                });
            }
        }
        
        // Rechercher dans le fichier
        function seek(e) {
            if (!currentAudio || !currentAudio.duration) return;
            
            const progressBar = document.querySelector('.progress-bar-container');
            const clickX = e.offsetX;
            const width = progressBar.offsetWidth;
            const seekTime = (clickX / width) * currentAudio.duration;
            
            currentAudio.currentTime = seekTime;
        }
        
        // Activer/D√©sactiver le son
        function toggleMute() {
            if (!currentAudio) return;
            
            currentAudio.muted = !currentAudio.muted;
            document.getElementById('volumeBtn').textContent = currentAudio.muted ? 'üîá' : 'üîä';
        }
        
        // D√©finir le volume
        function setVolume(e) {
            if (!currentAudio) return;
            
            const volumeSlider = document.querySelector('.volume-slider-container');
            const clickX = e.offsetX;
            const width = volumeSlider.offsetWidth;
            const volume = clickX / width;
            
            currentAudio.volume = volume;
            document.getElementById('volumeBar').style.width = (volume * 100) + '%';
            
            // Changer l'ic√¥ne selon le volume
            if (volume === 0) {
                document.getElementById('volumeBtn').textContent = 'üîá';
            } else if (volume < 0.5) {
                document.getElementById('volumeBtn').textContent = 'üîâ';
            } else {
                document.getElementById('volumeBtn').textContent = 'üîä';
            }
        }
        
        // Basculer favori
        function toggleFavorite() {
            if (!currentContent) return;
            toggleFavoriteContent(currentContent.id, document.getElementById('playerFavoriteBtn'));
        }
        
        // Basculer favori pour un contenu
        function toggleFavoriteContent(contentId, button) {
            try {
                const contents = JSON.parse(localStorage.getItem('pariszik_contents') || '[]');
                const contentIndex = contents.findIndex(c => c.id === contentId);
                
                if (contentIndex !== -1) {
                    contents[contentIndex].isFavorite = !contents[contentIndex].isFavorite;
                    
                    if (contents[contentIndex].isFavorite) {
                        button.textContent = '‚ù§Ô∏è';
                        button.style.color = '#dc3545';
                        alert('Ajout√© aux favoris');
                    } else {
                        button.textContent = '‚ù§Ô∏è';
                        button.style.color = '';
                        alert('Retir√© des favoris');
                    }
                    
                    localStorage.setItem('pariszik_contents', JSON.stringify(contents));
                }
            } catch (error) {
                console.error('Erreur lors de la gestion des favoris:', error);
            }
        }
        
        // Incr√©menter le nombre de vues
        function incrementViews(contentId) {
            try {
                const contents = JSON.parse(localStorage.getItem('pariszik_contents') || '[]');
                const contentIndex = contents.findIndex(c => c.id === contentId);
                
                if (contentIndex !== -1) {
                    contents[contentIndex].views = (contents[contentIndex].views || 0) + 1;
                    localStorage.setItem('pariszik_contents', JSON.stringify(contents));
                }
            } catch (error) {
                console.error('Erreur lors de l\'incr√©mentation des vues:', error);
            }
        }
        
        // Formater le temps
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }
    </script>
</body>
</html>